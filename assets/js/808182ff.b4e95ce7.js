"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9088],{142:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"Cronograma das Aulas/Semana 11/Aula 51/Controllers do ASP.NET MVC","title":"Controllers do ASP.NET MVC","description":"Introdu\xe7\xe3o","source":"@site/docs/Cronograma das Aulas/Semana 11/Aula 51/01. Controllers do ASP.NET MVC.mdx","sourceDirName":"Cronograma das Aulas/Semana 11/Aula 51","slug":"/Cronograma das Aulas/Semana 11/Aula 51/Controllers do ASP.NET MVC","permalink":"/blog/docs/Cronograma das Aulas/Semana 11/Aula 51/Controllers do ASP.NET MVC","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Aula 50","permalink":"/blog/docs/Cronograma das Aulas/Semana 10/Aula 50/"},"next":{"title":"Views do ASP.NET MVC","permalink":"/blog/docs/Cronograma das Aulas/Semana 11/Aula 51/Views do ASP.NET MVC"}}');var t=n(4848),a=n(8453);const i={},s=void 0,d={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Utilizando Controllers do ASP.NET MVC",id:"utilizando-controllers-do-aspnet-mvc",level:2},{value:"Controlador de Fabricante",id:"controlador-de-fabricante",level:2},{value:"Retorno de HTML com ActionResults",id:"retorno-de-html-com-actionresults",level:3}];function l(e){const r={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-cs",children:'static void Main(string[] args)\r\n{\r\n\t// criar um servidor web\r\n\tWebApplicationBuilder builder = WebApplication.CreateBuilder(args);\r\n\r\n\tbuilder.Services.AddControllers();\r\n\r\n\tWebApplication app = builder.Build();\r\n\r\n\t// mapeamento de rotas\r\n\tapp.MapGet("/", PaginaInicial);\r\n\r\n\tapp.MapGet("/fabricantes/cadastrar", ExibirFormularioCadastroFabricante);\r\n\tapp.MapPost("/fabricantes/cadastrar", CadastrarFabricante);\r\n\r\n\tapp.MapGet("/fabricantes/editar/{id:int}", ExibirFormularioEdicaoFabricante);\r\n\tapp.MapPost("/fabricantes/editar/{id:int}", EditarFabricante);\r\n\r\n\tapp.MapGet("/fabricantes/excluir/{id:int}", ExibirFormularioExclusaoFabricante);\r\n\tapp.MapPost("/fabricantes/excluir/{id:int}", ExcluirFabricante);\r\n\r\n\tapp.MapGet("/fabricantes/visualizar", VisualizarFabricantes);\r\n\r\n\tapp.MapControllers();\r\n\r\n\tapp.Run();\r\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"No modelo inicial que fizemos:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["O ",(0,t.jsxs)(r.strong,{children:["programa ASP.NET \xe9 respons\xe1vel por mapear cada rota de forma expl\xedcita, dentro do ",(0,t.jsx)(r.code,{children:"Program.cs"})]}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["Cada rota (",(0,t.jsx)(r.code,{children:"app.MapGet(...)"}),", ",(0,t.jsx)(r.code,{children:"app.MapPost(...)"}),") recebe uma fun\xe7\xe3o an\xf4nima (",(0,t.jsx)(r.code,{children:"Task"})," ou ",(0,t.jsx)(r.code,{children:"Func<HttpContext, Task>"}),") que acessa diretamente o ",(0,t.jsx)(r.code,{children:"HttpContext"}),"."]}),"\n",(0,t.jsx)(r.li,{children:"A responsabilidade de buscar dados, tratar o HTML, e construir as respostas est\xe1 toda centralizada ali mesmo."}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"utilizando-controllers-do-aspnet-mvc",children:"Utilizando Controllers do ASP.NET MVC"}),"\n",(0,t.jsxs)(r.p,{children:["Iremos criar uma nova classe chamada ",(0,t.jsx)(r.code,{children:"ControladorInicial"})," na pasta ",(0,t.jsx)(r.code,{children:"Controllers"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-cs",children:'[Route("/")]\r\npublic class ControladorInicial : Controller\r\n{\r\n    [HttpGet]\r\n    public IActionResult PaginaInicial()\r\n    {\r\n        string conteudo = System.IO.File.ReadAllText("Compartilhado/Html/PaginaInicial.html");\r\n\r\n        return Content(conteudo, "text/html");\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"C\xf3digo"}),(0,t.jsx)(r.th,{children:"Explica\xe7\xe3o"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:'[Route("/")]'})}),(0,t.jsxs)(r.td,{children:["Define que esse controller responder\xe1 \xe0 rota raiz (",(0,t.jsx)(r.code,{children:"/"}),")."]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"public class ControladorInicial : Controller"})}),(0,t.jsxs)(r.td,{children:["Herdando de ",(0,t.jsx)(r.code,{children:"Controller"}),", agora temos acesso a m\xe9todos como ",(0,t.jsx)(r.code,{children:"Content()"}),", ",(0,t.jsx)(r.code,{children:"View()"}),", ",(0,t.jsx)(r.code,{children:"Redirect()"}),"."]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"[HttpGet]"})}),(0,t.jsxs)(r.td,{children:["Esse m\xe9todo ser\xe1 chamado quando algu\xe9m acessar ",(0,t.jsx)(r.code,{children:"GET /"}),"."]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:'Content(conteudo, "text/html")'})}),(0,t.jsx)(r.td,{children:"Retorna o conte\xfado HTML lido diretamente do arquivo."})]})]})]}),"\n",(0,t.jsxs)(r.p,{children:["Voc\xea pode ",(0,t.jsxs)(r.strong,{children:["remover o ",(0,t.jsx)(r.code,{children:'app.MapGet("/", PaginaInicial)'})]})," e incluir as linhas ",(0,t.jsx)(r.code,{children:"AddControllers"})," e ",(0,t.jsx)(r.code,{children:"MapControllers"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-cs",children:"static void Main(string[] args)\r\n{\r\n\t// cria um servidor web\r\n\tWebApplicationBuilder builder = WebApplication.CreateBuilder(args);\r\n\r\n\t// procura controladores no c\xf3digo fonte\r\n\tbuilder.Services.AddControllers();\r\n\r\n\tWebApplication app = builder.Build();\r\n\r\n\t// mapeamento de rotas\r\n\t// rotas de fabricantes\r\n\r\n\t// mapeia controladores obtidos para o servidor\r\n\tapp.MapControllers();\r\n\r\n\tapp.Run();\r\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Agora, mantemos toda a l\xf3gica de apresenta\xe7\xe3o da p\xe1gina inicial isolada no ",(0,t.jsx)(r.code,{children:"ControladorInicial"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"controlador-de-fabricante",children:"Controlador de Fabricante"}),"\n",(0,t.jsxs)(r.p,{children:["Ao migrar para o modelo de ",(0,t.jsx)(r.strong,{children:"Controllers"}),", voc\xea adota o padr\xe3o de arquitetura ",(0,t.jsx)(r.strong,{children:"MVC (Model-View-Controller)"}),", onde Controllers passam a ser classes dedicadas, herdando de ",(0,t.jsx)(r.code,{children:"Controller"}),"."]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Cada ",(0,t.jsx)(r.strong,{children:"controller agrupa rotas relacionadas a um contexto espec\xedfico"})," (",(0,t.jsx)(r.code,{children:"Fabricante"}),", ",(0,t.jsx)(r.code,{children:"Equipamento"}),", ",(0,t.jsx)(r.code,{children:"Chamado"}),", etc.)."]}),"\n",(0,t.jsxs)(r.li,{children:["As rotas s\xe3o organizadas com ",(0,t.jsxs)(r.strong,{children:["atributos ",(0,t.jsx)(r.code,{children:"[Route]"}),", ",(0,t.jsx)(r.code,{children:"[HttpGet]"}),", ",(0,t.jsx)(r.code,{children:"[HttpPost]"})]}),", sem necessidade de mapear tudo no ",(0,t.jsx)(r.code,{children:"Program.cs"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["O ASP.NET cuida ",(0,t.jsx)(r.strong,{children:"automaticamente do roteamento, do binding de dados e da cria\xe7\xe3o das respostas HTTP"}),", deixando o c\xf3digo mais limpo."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"retorno-de-html-com-actionresults",children:"Retorno de HTML com ActionResults"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-cs",children:'[Route("fabricantes")]\r\npublic class ControladorFabricante : Controller\r\n{\r\n    [HttpGet("cadastrar")]\r\n    public IActionResult ExibirFormularioCadastroFabricante()\r\n    {\r\n        string conteudo = System.IO.File.ReadAllText("ModuloFabricante/Html/Cadastrar.html");\r\n\r\n        return Content(conteudo, "text/html");\r\n    }\r\n\r\n    [HttpPost("cadastrar")]\r\n    public IActionResult CadastrarFabricante([FromForm] string nome, [FromForm] string email, [FromForm] string telefone)\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        Fabricante novoFabricante = new Fabricante(nome, email, telefone);\r\n\r\n        repositorioFabricante.CadastrarRegistro(novoFabricante);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("Compartilhado/Html/Notificacao.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n        sb.Replace("#mensagem#", $"O registro \\"{novoFabricante.Nome}\\" foi cadastrado com sucesso!");\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n\r\n    [HttpGet("editar/{id:int}")]\r\n    public IActionResult ExibirFormularioEdicaoFabricante(int id)\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        Fabricante fabricanteSelecionado = repositorioFabricante.SelecionarRegistroPorId(id);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("ModuloFabricante/Html/Editar.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n        sb.Replace("#id#", id.ToString());\r\n        sb.Replace("#nome#", fabricanteSelecionado.Nome);\r\n        sb.Replace("#email#", fabricanteSelecionado.Email);\r\n        sb.Replace("#telefone#", fabricanteSelecionado.Telefone);\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n\r\n    [HttpPost("editar/{id:int}")]\r\n    public IActionResult EditarFabricante(int id, [FromForm] string nome, [FromForm] string email, [FromForm] string telefone)\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        Fabricante fabricanteAtualizado = new Fabricante(nome, email, telefone);\r\n\r\n        repositorioFabricante.EditarRegistro(id, fabricanteAtualizado);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("Compartilhado/Html/Notificacao.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n        sb.Replace("#mensagem#", $"O registro \\"{fabricanteAtualizado.Nome}\\" foi editado com sucesso!");\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n\r\n    [HttpGet("excluir/{id:int}")]\r\n    public IActionResult ExibirFormularioExclusaoFabricante(int id)\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        Fabricante fabricanteSelecionado = repositorioFabricante.SelecionarRegistroPorId(id);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("ModuloFabricante/Html/Excluir.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n        sb.Replace("#id#", id.ToString());\r\n        sb.Replace("#fabricante#", fabricanteSelecionado.Nome);\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n\r\n    [HttpPost("excluir/{id:int}")]\r\n    public IActionResult ExcluirFabricante(int id)\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        repositorioFabricante.ExcluirRegistro(id);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("Compartilhado/Html/Notificacao.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n        sb.Replace("#mensagem#", $"O registro foi exclu\xeddo com sucesso!");\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n\r\n    [HttpGet("visualizar")]\r\n    public IActionResult VisualizarFabricantes()\r\n    {\r\n        ContextoDados contextoDados = new ContextoDados(true);\r\n        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);\r\n\r\n        string conteudo = System.IO.File.ReadAllText("ModuloFabricante/Html/Visualizar.html");\r\n\r\n        StringBuilder sb = new StringBuilder(conteudo);\r\n\r\n        List<Fabricante> fabricantes = repositorioFabricante.SelecionarRegistros();\r\n\r\n        foreach (Fabricante f in fabricantes)\r\n        {\r\n            string itemLista = $"<li>{f} / <a href=\\"/fabricantes/editar/{f.Id}\\">Editar</a> / <a href=\\"/fabricantes/excluir/{f.Id}\\">Excluir</a> </li> #fabricante#";\r\n            sb.Replace("#fabricante#", itemLista);\r\n        }\r\n\r\n        sb.Replace("#fabricante#", "");\r\n\r\n        return Content(sb.ToString(), "text/html");\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"Agora, o ASP.NET reconhece:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Que essa classe atende rotas que come\xe7am com ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"/fabricantes"})}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["Que esse m\xe9todo atende especificamente ao verbo ",(0,t.jsxs)(r.strong,{children:["GET na rota ",(0,t.jsx)(r.code,{children:"/fabricantes/cadastrar"})]}),"."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["A ",(0,t.jsxs)(r.strong,{children:["requisi\xe7\xe3o \xe9 automaticamente roteada e os par\xe2metros s\xe3o convertidos (",(0,t.jsx)(r.code,{children:"model binding"}),")"]}),"."]}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.th,{children:["Antigo (",(0,t.jsx)(r.code,{children:"HttpContext"}),")"]}),(0,t.jsxs)(r.th,{children:["Novo (",(0,t.jsx)(r.code,{children:"Controllers"}),")"]})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["Mapear rotas manualmente no ",(0,t.jsx)(r.code,{children:"Program.cs"})," com ",(0,t.jsx)(r.code,{children:"app.MapGet(...)"})]}),(0,t.jsxs)(r.td,{children:["Deixar o ASP.NET mapear as rotas automaticamente com ",(0,t.jsx)(r.code,{children:"[Route]"}),", ",(0,t.jsx)(r.code,{children:"[HttpGet]"}),", ",(0,t.jsx)(r.code,{children:"[HttpPost]"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["Manipular ",(0,t.jsx)(r.code,{children:"HttpContext"})," diretamente"]}),(0,t.jsxs)(r.td,{children:["Usar ",(0,t.jsx)(r.code,{children:"IActionResult"})," e helpers como ",(0,t.jsx)(r.code,{children:"Content"}),", ",(0,t.jsx)(r.code,{children:"View"}),", ",(0,t.jsx)(r.code,{children:"Redirect"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["Dados enviados pelo usu\xe1rio recuperados com ",(0,t.jsx)(r.code,{children:'context.Request.Form["campo"]'})]}),(0,t.jsxs)(r.td,{children:["ASP.NET faz o binding autom\xe1tico com ",(0,t.jsx)(r.code,{children:"[FromForm]"}),", ",(0,t.jsx)(r.code,{children:"[FromRoute]"}),", ",(0,t.jsx)(r.code,{children:"[FromQuery]"})]})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Dif\xedcil reutiliza\xe7\xe3o e testes"}),(0,t.jsx)(r.td,{children:"Controllers isolados, f\xe1ceis de testar e evoluir"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["C\xf3digo monol\xedtico e centralizado no ",(0,t.jsx)(r.code,{children:"Program.cs"})]}),(0,t.jsx)(r.td,{children:"C\xf3digo organizado em controllers separados"})]})]})]})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>s});var o=n(6540);const t={},a=o.createContext(t);function i(e){const r=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(a.Provider,{value:r},e.children)}}}]);