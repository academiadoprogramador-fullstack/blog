## Introdu√ß√£o

Agora, iremos aplicar o conceito de ViewModels na aplica√ß√£o **Gest√£o de Equipamentos.**

No **m√≥dulo Fabricante**, para cada opera√ß√£o CRUD relacionada ao mesmo, iremos especificar um ViewModel:
## ViewModels Compartilhados

### `NotificacaoViewModel`

```cs
public class NotificacaoViewModel
{
    public string TituloPagina { get; set; }
    public string Mensagem { get; set; }

    public NotificacaoViewModel(string tituloPagina, string mensagem)
    {
        TituloPagina = tituloPagina;
        Mensagem = mensagem;
    }
}
```
## Fun√ß√£o:

- **ViewModel gen√©rico para notifica√ß√µes** para todos as a√ß√µes dos controladores.
- Centraliza a passagem de mensagem para a View `Notificacao.cshtml`.

---
## ViewModels de Fabricante

### `FormularioFabricanteViewModel`

```cs
public abstract class FormularioFabricanteViewModel
{
    public abstract string TituloPagina { get; }
    public string Nome { get; set; }
    public string Email { get; set; }
    public string Telefone { get; set; }
}
```
#### Fun√ß√£o:

- **ViewModel base gen√©rico** para formul√°rios de **Cadastro** e **Edi√ß√£o**.
- Centraliza propriedades comuns (`Nome`, `Email`, `Telefone`).
- Possui `TituloPagina` abstrato, que ser√° implementado de maneira diferente por cada classe derivada.
#### üö© Usado como **base de heran√ßa** por:

- `CadastrarFabricanteViewModel`
- `EditarFabricanteViewModel`

---
### `CadastrarFabricanteViewModel`

```cs
public class CadastrarFabricanteViewModel : FormularioFabricanteViewModel
{
    public override string TituloPagina { get; } = "Cadastro de Fabricantes";
}
```
#### Fun√ß√£o:

- Especializa√ß√£o para o formul√°rio de **Cadastro**.
- Apenas define o t√≠tulo da p√°gina.
- Utiliza as propriedades herdadas para capturar os dados do novo fabricante.
#### üîó Usado em:

- `Cadastrar` (GET/POST)

---
### `EditarFabricanteViewModel`

```cs
public class EditarFabricanteViewModel : FormularioFabricanteViewModel
{
    public override string TituloPagina { get; } = "Edi√ß√£o de Fabricantes";

    public int Id { get; set; }

    public EditarFabricanteViewModel(int id, string nome, string email, string telefone)
    {
        Id = id;
        Nome = nome;
        Email = email;
        Telefone = telefone;
    }
}
```
#### Fun√ß√£o:

- Especializa√ß√£o para o formul√°rio de **Edi√ß√£o**.
- Inicializa o ViewModel com dados existentes (`Nome`, `Email`, `Telefone`).
- Cont√©m um Id utilizado para edi√ß√£o
- Define t√≠tulo pr√≥prio.
#### üîó Usado em:

- `Editar` (GET/POST)

---
### `ExcluirFabricanteViewModel`

```cs
public class ExcluirFabricanteViewModel
{
    public string TituloPagina { get; } = "Exclus√£o de Fabricantes";
    public int Id { get; set; }
    public string Nome { get; set; }

    public ExcluirFabricanteViewModel(int id, string nome)
    {
        Id = id;
        Nome = nome;
    }
}
```
#### Fun√ß√£o:

- ViewModel enxuto usado apenas para **confirmar exclus√£o**.
- Cont√©m o `Id` e o `Nome` do fabricante para apresentar ao usu√°rio.
- T√≠tulo da p√°gina de confirma√ß√£o.
#### üîó Usado em:

- `Excluir` (GET)

---
### `VisualizarFabricantesViewModel`

```cs
public class VisualizarFabricantesViewModel
{
    public string TituloPagina { get; } = "Visualiza√ß√£o de Fabricantes";

    public List<DetalhesFabricanteViewModel> Registros { get; } = new List<DetalhesFabricanteViewModel>();

    public VisualizarFabricantesViewModel(List<Fabricante> fabricantes)
    {
        foreach (Fabricante fabricante in fabricantes)
        {
            DetalhesFabricanteViewModel detalhesVM = fabricante.ParaDetalhesFabricanteViewModel();
            Registros.Add(detalhesVM);
        }
    }
}
```
#### Fun√ß√£o:

- Encapsula uma **lista de fabricantes formatados para exibi√ß√£o**.
- Converte entidades `Fabricante` em `DetalhesFabricanteViewModel`.
- Define um t√≠tulo para a p√°gina de visualiza√ß√£o.
#### üîó Usado em:

- `Visualizar` (GET)

---
### `DetalhesFabricanteViewModel`

```cs
public class DetalhesFabricanteViewModel
{
    public int Id { get; set; }
    public string Nome { get; set; }
    public string Email { get; set; }
    public string Telefone { get; set; }

    public DetalhesFabricanteViewModel(int id, string nome, string email, string telefone)
    {
        Id = id;
        Nome = nome;
        Email = email;
        Telefone = telefone;
    }

    public override string ToString()
    {
        return $"Id: {Id}, Nome: {Nome}, Email: {Email}, Telefone: {Telefone}";
    }
}
```
#### Fun√ß√£o:

- **ViewModel detalhado de fabricante individual**, usado principalmente dentro do `VisualizarFabricantesViewModel`.
- Facilita exibir as informa√ß√µes completas de cada fabricante em tabelas, cards, etc.
## Resumo dos ViewModels de Fabricante

| ViewModel                      | Finalidade                                     | Tela/A√ß√£o                 |
| ------------------------------ | ---------------------------------------------- | ------------------------- |
| FormularioFabricanteViewModel  | Base comum para formul√°rios (Nome, Email, Tel) | Base para Cadastro/Edi√ß√£o |
| CadastrarFabricanteViewModel   | ViewModel de cadastro de fabricante            | Cadastro (GET/POST)       |
| EditarFabricanteViewModel      | ViewModel de edi√ß√£o de fabricante              | Edi√ß√£o (GET/POST)         |
| ExcluirFabricanteViewModel     | ViewModel para confirma√ß√£o de exclus√£o         | Exclus√£o (GET)            |
| VisualizarFabricantesViewModel | Lista de fabricantes prontos para exibi√ß√£o     | Visualiza√ß√£o (GET)        |
| DetalhesFabricanteViewModel    | Detalhamento de um fabricante (usado na lista) | Dentro da Visualiza√ß√£o    |

## Como os ViewModels est√£o sendo usados em cada caso

No nosso c√≥digo c√≥digo, iremos utilizar **ViewModels** como **camada intermedi√°ria entre o Controller e as Views**.  
Cada opera√ß√£o (`Cadastrar`, `Editar`, `Excluir`, `Visualizar`) tem seu pr√≥prio **ViewModel especializado**, que serve para:

- Organizar os dados necess√°rios para cada tela.
- Realizar valida√ß√µes espec√≠ficas de interface.
- Traduzir entre a View e o **Model real (`Fabricante`)**.

---
### 1. `CadastrarFabricanteViewModel`

Usado tanto no `GET` quanto no `POST` para cadastrar fabricantes.

- No `GET`:
    
    - O Controller cria uma inst√¢ncia vazia do ViewModel (`CadastrarFabricanteViewModel`) e envia para a View.
    
- No `POST`:
    
    - A View envia os dados preenchidos via `CadastrarFabricanteViewModel`.
    - O Controller converte o ViewModel em um **Model real (`Fabricante`)** usando `cadastrarVM.ParaEntidade()`.
    - O Controller ent√£o usa o reposit√≥rio para persistir o `Fabricante`.

‚úî Aqui o **ViewModel protege o Model real**, expondo apenas os campos que a View precisa e permite valida√ß√µes espec√≠ficas de tela.

```cs
[Route("fabricantes")]
public class ControladorFabricante : Controller
{
    [HttpGet("cadastrar")]
    public IActionResult ExibirFormularioCadastroFabricante()
    {
        CadastrarFabricanteViewModel cadastrarVM = new CadastrarFabricanteViewModel();

        return View("Cadastrar", cadastrarVM);
    }

    [HttpPost("cadastrar")]
    public IActionResult CadastrarFabricante(CadastrarFabricanteViewModel cadastrarVM)
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        Fabricante novoFabricante = cadastrarVM.ParaEntidade();

        repositorioFabricante.CadastrarRegistro(novoFabricante);

        NotificacaoViewModel notificacaoVM = new NotificacaoViewModel(
            "Fabricante Cadastrado!",
            $"O registro \"{novoFabricante.Nome}\" foi cadastrado com sucesso!"
        );

        return View("Notificacao", notificacaoVM);
    }
}
```

```html
@using GestaoDeEquipamentos.ConsoleApp.ViewModels
@using GestaoDeEquipamentos.ConsoleApp.ViewModels.ControladorFabricante

@model CadastrarFabricanteViewModel;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Cadastro de Fabricante - Gest√£o de Equipamentos</title>
</head>

<body>
    <h1>Gest√£o de Equipamentos</h1>

    <hr />

    <a href="/">P√°gina Inicial</a> /
    <a href="/fabricantes/visualizar">Visualizar Fabricantes</a>

    <hr />

    <h3>@Model.TituloPagina</h3>

    <form action="/fabricantes/cadastrar" method="post">
        <label>Nome do Fabricante:</label>
        <br />
        <input type="text" name="Nome"/>

        <br />

        <label>Email do Fabricante:</label>
        <br />
        <input type="text" name="Email" />

        <br />

        <label>Telefone do Fabricante:</label>
        <br />
        <input type="text" name="Telefone" />
        <hr />

        <button type="submit">Gravar</button>
    </form>
</body>
</html>
```

---
### 2. `EditarFabricanteViewModel`

Usado tanto no `GET` quanto no `POST` para edi√ß√£o.

- No `GET`:
    
    - O Controller busca o `Fabricante` no reposit√≥rio.
    - Cria um `EditarFabricanteViewModel` com os dados do `Fabricante`.
    - Envia o ViewModel para a View.
    
- No `POST`:
    
    - Recebe os dados do `EditarFabricanteViewModel`.
    - Converte para `Fabricante` via `editarVM.ParaEntidade()`.
    - Atualiza o `Fabricante` no reposit√≥rio.

‚úî Novamente, o ViewModel permite que voc√™ exponha apenas o necess√°rio, sem a View manipular diretamente a entidade de dom√≠nio.

```cs
[Route("fabricantes")]
public class ControladorFabricante : Controller
{
    [HttpGet("editar/{id:int}")]
    public IActionResult ExibirFormularioEdicaoFabricante([FromRoute] int id)
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        Fabricante fabricanteSelecionado = repositorioFabricante.SelecionarRegistroPorId(id);

        EditarFabricanteViewModel editarVM = new EditarFabricanteViewModel(
            fabricanteSelecionado.Nome,
            fabricanteSelecionado.Email,
            fabricanteSelecionado.Telefone
        );

        return View("Editar", editarVM);
    }

    [HttpPost("editar/{id:int}")]
    public IActionResult EditarFabricante([FromRoute] int id, EditarFabricanteViewModel editarVM)
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        Fabricante fabricanteAtualizado = editarVM.ParaEntidade();

        repositorioFabricante.EditarRegistro(id, fabricanteAtualizado);

        NotificacaoViewModel notificacaoVM = new NotificacaoViewModel(
            "Fabricante Editado!",
            $"O registro \"{fabricanteAtualizado.Nome}\" foi editado com sucesso!"
        );

        return View("Notificacao", notificacaoVM);
    }
```

```html
@using GestaoDeEquipamentos.ConsoleApp.ModuloFabricante
@using GestaoDeEquipamentos.ConsoleApp.ViewModels
@using GestaoDeEquipamentos.ConsoleApp.ViewModels.ControladorFabricante

@model EditarFabricanteViewModel;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Edi√ß√£o de Fabricante - Gest√£o de Equipamentos</title>
</head>

<body>
    <h1>Gest√£o de Equipamentos</h1>

    <hr />

    <a href="/">P√°gina Inicial</a> /
    <a href="/fabricantes/cadastrar">Cadastrar Novo Fabricante</a> /
    <a href="/fabricantes/visualizar">Visualizar Fabricantes</a>

    <hr />

    <h3>@Model.TituloPagina</h3>

    <form action="/fabricantes/editar/@Model.Id" method="post">
        <label>Nome do Fabricante:</label>
        <br />
        <input type="text" name="Nome" value="@Model.Nome" />

        <br />

        <label>Email do Fabricante:</label>
        <br />
        <input type="text" name="Email" value="@Model.Email" />

        <br />

        <label>Telefone do Fabricante:</label>
        <br />
        <input type="text" name="Telefone" value="@Model.Telefone" />
        <hr />

        <button type="submit">Gravar</button>
    </form>
</body>
</html>
```

---
### 3. `ExcluirFabricanteViewModel`

Usado no `GET` para exibir confirma√ß√£o de exclus√£o.

- O Controller busca o `Fabricante` pelo `id`.
- Cria um `ExcluirFabricanteViewModel` contendo apenas o `Id` e o `Nome`.
- Envia esse ViewModel para a View de confirma√ß√£o.

‚úî Isso evita expor toda a entidade, apenas os dados que a tela de exclus√£o precisa mostrar.

```cs
[Route("fabricantes")]
public class ControladorFabricante : Controller
{
    [HttpGet("excluir/{id:int}")]
    public IActionResult ExibirFormularioExclusaoFabricante([FromRoute] int id)
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        Fabricante fabricanteSelecionado = repositorioFabricante.SelecionarRegistroPorId(id);

        ExcluirFabricanteViewModel excluirVM = new ExcluirFabricanteViewModel(id, fabricanteSelecionado.Nome);

        return View("Excluir", excluirVM);
    }

    [HttpPost("excluir/{id:int}")]
    public IActionResult ExcluirFabricante([FromRoute] int id)
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        repositorioFabricante.ExcluirRegistro(id);

        NotificacaoViewModel notificacaoVM = new NotificacaoViewModel(
            "Fabricante Exclu√≠do!",
            "O registro foi exclu√≠do com sucesso!"
        );

        return View("Notificacao", notificacaoVM);
    }
```

```html
@using GestaoDeEquipamentos.ConsoleApp.ModuloFabricante
@using GestaoDeEquipamentos.ConsoleApp.ViewModels
@using GestaoDeEquipamentos.ConsoleApp.ViewModels.ControladorFabricante

@model ExcluirFabricanteViewModel;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Exclus√£o de Fabricante - Gest√£o de Equipamentos</title>
</head>

<body>
    <h1>Gest√£o de Equipamentos</h1>

    <hr />

    <a href="/">P√°gina Inicial</a> /
    <a href="/fabricantes/cadastrar">Cadastrar Novo Fabricante</a> /
    <a href="/fabricantes/visualizar">Visualizar Fabricantes</a>

    <hr />

    <h3>Exclus√£o de Fabricante</h3>

    <p>Voc√™ tem certeza que deseja excluir o registro "@Model.Nome"?</p>

    <form action="/fabricantes/excluir/@Model.Id" method="post">
        <button type="submit">Confirmar</button>
        <a href="/fabricantes/visualizar">Voltar</a>
    </form>
</body>
</html>
```

---
### 4. **VisualizarFabricantesViewModel**

Usado no `GET` para exibir todos os fabricantes.

- O Controller busca todos os `Fabricante` no reposit√≥rio.
- Cria um `VisualizarFabricantesViewModel` que encapsula a lista.
- Envia o ViewModel para a View.

‚úî Permite que a View apenas enxergue a cole√ß√£o j√° organizada, podendo at√© conter dados adicionais, como contagem ou mensagens.

```cs
[Route("fabricantes")]
public class ControladorFabricante : Controller
{
    [HttpGet("visualizar")]
    public IActionResult VisualizarFabricantes()
    {
        ContextoDados contextoDados = new ContextoDados(true);
        IRepositorioFabricante repositorioFabricante = new RepositorioFabricanteEmArquivo(contextoDados);

        List<Fabricante> fabricantes = repositorioFabricante.SelecionarRegistros();

        VisualizarFabricantesViewModel visualizarVM = new VisualizarFabricantesViewModel(fabricantes);

        return View("Visualizar", visualizarVM);
    }
}
```

```html
@using GestaoDeEquipamentos.ConsoleApp.ModuloFabricante
@using GestaoDeEquipamentos.ConsoleApp.ViewModels
@using GestaoDeEquipamentos.ConsoleApp.ViewModels.ControladorFabricante

@model VisualizarFabricantesViewModel;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Visualiza√ß√£o de Fabricantes - Gest√£o de Equipamentos</title>
</head>

<body>
    <h1>Gest√£o de Equipamentos</h1>

    <hr />

    <a href="/">P√°gina Inicial</a> /
    <a href="/fabricantes/cadastrar">Cadastrar Novo Fabricante</a> /

    <hr />

    <h3>@Model.TituloPagina</h3>

    <ul>
        @foreach (DetalhesFabricanteViewModel f in Model.Registros)
        {
            <li>@f.ToString() / <a href="/fabricantes/editar/@f.Id">Editar</a> /
                <a href="/fabricantes/excluir/@f.Id">Excluir</a></li>
        }
    </ul>
</body>
</html>
```

---
###  Modelo da `Notificacao.cshtml`

```html
@using GestaoDeEquipamentos.ConsoleApp.ViewModels
@using GestaoDeEquipamentos.ConsoleApp.ViewModels.Shared

@model NotificacaoViewModel;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>@Model.TituloPagina - Gest√£o de Equipamentos</title>
</head>

<body>
    <h1>Gest√£o de Equipamentos</h1>

    <hr />

    <a href="/">P√°gina Inicial</a> /

    <hr />

    <h3>@Model.TituloPagina</h3>

    <p>@Model.Mensagem</p>
</body>
</html>
```

Usado em diversas a√ß√µes (`Cadastrar`, `Editar`, `Excluir`) para mostrar mensagens amig√°veis de sucesso.

‚úî Um ViewModel gen√©rico de feedback ao usu√°rio, evitando misturar l√≥gica de dom√≠nio com mensagens de interface.

---
## Por que isso √© importante?

- **Seguran√ßa**: evita que a View tenha acesso direto ao Model.
- **Organiza√ß√£o**: cada tela tem seu ViewModel espec√≠fico com seus campos e valida√ß√µes.
- **Desacoplamento**: facilita mudan√ßas na interface sem impactar a camada de dom√≠nio.
- **Responsabilidade √∫nica**: ViewModels cuidam da interface, Models cuidam do dom√≠nio.
